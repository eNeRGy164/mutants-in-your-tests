{
  "$schema": "https://demotime.elio.dev/demo-time.schema.json",
  "title": "03 - Equivalent mutants",
  "description": "Explore equivalent mutants - mutations that don't change program behavior - and learn how to configure Stryker to handle them effectively, demonstrating that not all surviving mutants indicate poor test quality.",
  "demos": [
    {
      "title": "Show Calculator.cs",
      "description": "Display the calculator class to prepare for adding a method that will demonstrate the concept of equivalent mutants.",
      "steps": [
        {
          "action": "closeTerminal"
        },
        {
          "action": "create",
          "path": "/cs/Calculator/Calculator.cs",
          "contentPath": "/snapshots/Calculator.snapshot.cs"
        },
        {
          "action": "open",
          "path": "/cs/Calculator/Calculator.cs"
        },
        {
          "action": "positionCursor",
          "path": "/cs/Calculator/Calculator.cs",
          "position": "1"
        }
      ]
    },
    {
      "title": "Add \"NoOperation\" method",
      "description": "Add a no-operation method that adds zero to demonstrate equivalent mutants - mutations that don't change the behavior.",
      "steps": [
        {
          "action": "replace",
          "path": "/cs/Calculator/Calculator.cs",
          "position": "31,0",
          "content": "\n    public int Noop(int a)\n    {\n        return a + 0;\n    }\n}",
          "lineInsertionDelay": 500
        },
        {
          "action": "highlight",
          "path": "/cs/Calculator/Calculator.cs",
          "position": "32:35"
        }
      ]
    },
    {
      "title": "Show CalculatorTests.cs",
      "description": "Open the test file to prepare for adding a test for the no-operation method.",
      "steps": [
        {
          "action": "open",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs"
        },
        {
          "action": "positionCursor",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "54"
        }
      ]
    },
    {
      "title": "Add \"DoesNoop\" test",
      "description": "Add a comprehensive test for the no-operation method that verifies it returns the input unchanged.",
      "steps": [
        {
          "action": "insert",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "54,0",
          "content": "\n        [Fact]\n        public void DoesNoop()\n        {\n            var result = this.calculator.Noop(4);\n\n            Assert.Equal(4, result);\n        }\n    }",
          "lineInsertionDelay": 500
        },
        {
          "action": "highlight",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "55:61"
        }
      ]
    },
    {
      "title": "Run Stryker.NET",
      "description": "Execute mutation testing to see how the no-operation method creates equivalent mutants that survive despite good tests.",
      "steps": [
        {
          "action": "unselect",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs"
        },
        {
          "action": "executeTerminalCommand",
          "command": "Set-Location cs -ErrorAction SilentlyContinue"
        },
        {
          "action": "executeTerminalCommand",
          "command": "Clear"
        },
        {
          "action": "executeTerminalCommand",
          "command": "dotnet stryker"
        }
      ]
    },
    {
      "title": "Show Mutation Report",
      "description": "View the mutation report to see surviving mutants in the no-operation method that demonstrate equivalent mutants.",
      "steps": [
        {
          "action": "executeTerminalCommand",
          "command": "& (Get-ChildItem \"StrykerOutput\" -Directory | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Join-Path $_.FullName \"reports\\mutation-report.html\" })"
        }
      ]
    },
    {
      "title": "Show stryker-config.yaml",
      "description": "Display the Stryker configuration file to show how to configure equivalent mutant handling.",
      "steps": [
        {
          "action": "create",
          "path": "/cs/stryker-config.yaml",
          "contentPath": "/snapshots/stryker-config.snapshot.yaml"
        },
        {
          "action": "open",
          "path": "/cs/stryker-config.yaml"
        },
        {
          "action": "positionCursor",
          "path": "/cs/stryker-config.yaml",
          "position": "1"
        }
      ]
    },
    {
      "title": "Update configuration",
      "description": "Apply configuration changes to disable specific mutants for the no-operation method, demonstrating how to handle equivalent mutants.",
      "steps": [
        {
          "action": "applyPatch",
          "path": "/cs/stryker-config.yaml",
          "contentPath": "/snapshots/stryker-config.snapshot.yaml",
          "patch": "/patches/stryker-config patch.patch"
        },
        {
          "action": "open",
          "path": "/cs/stryker-config.yaml"
        }
      ]
    },
    {
      "title": "Run Stryker.NET",
      "description": "Re-run mutation testing with the updated configuration to see how equivalent mutants are now properly handled.",
      "steps": [
        {
          "action": "unselect",
          "path": "/cs/stryker-config.yaml"
        },
        {
          "action": "executeTerminalCommand",
          "command": "dotnet stryker"
        }
      ]
    },
    {
      "title": "Show Mutation Report",
      "description": "View the final mutation report to see how the configuration changes affected the mutation score by properly handling equivalent mutants.",
      "steps": [
        {
          "action": "executeTerminalCommand",
          "command": "& (Get-ChildItem \"StrykerOutput\" -Directory | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Join-Path $_.FullName \"reports\\mutation-report.html\" })"
        }
      ]
    }
  ]
}