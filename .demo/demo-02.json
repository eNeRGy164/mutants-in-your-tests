{
  "$schema": "https://demotime.elio.dev/demo-time.schema.json",
  "title": "02 - Mutation testing",
  "description": "Introduce mutation testing with Stryker.NET to reveal weaknesses in seemingly comprehensive unit tests and learn how mutation testing provides better insight into test quality than traditional code coverage.",
  "demos": [
    {
      "title": "Run Stryker.NET",
      "description": "Execute Stryker.NET mutation testing to generate mutated versions of the code and see how many mutants survive our existing tests.",
      "steps": [
        {
          "action": "executeTerminalCommand",
          "command": "dotnet stryker"
        }
      ]
    },
    {
      "title": "Show Mutation Report",
      "description": "Open the generated mutation report to analyze which mutants survived and understand how our tests are failing to catch code changes.",
      "steps": [
        {
          "action": "executeTerminalCommand",
          "command": "& (Get-ChildItem \"StrykerOutput\" -Directory | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Join-Path $_.FullName \"reports\\mutation-report.html\" })"
        }
      ]
    },
    {
      "title": "Show CalculatorTests.cs",
      "description": "Display the current test file to examine weak test assertions that allowed mutants to survive.",
      "steps": [
        {
          "action": "create",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "contentPath": "/snapshots/CalculatorTests.snapshot.cs"
        },
        {
          "action": "open",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs"
        },
        {
        "action": "highlight",
        "path": "/cs/Calculator.Specs/CalculatorTests.cs",
        "position": "14"
        }
      ]
    },
    {
      "title": "Fix \"Add_ReturnsSum\" test",
      "description": "Improve the Add test by adding a proper assertion that verifies the actual result, replacing the meaningless Assert.True(true).",
      "steps": [
        {
          "action": "replace",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "14",
          "content": "            Assert.Equal(3, result);"
        }
      ]
    },
    {
      "title": "Show \"Subtract_ReturnsRemainder\" test",
      "description": "Highlight the weak subtraction test that only checks if the result is positive, missing actual value verification.",
      "steps": [
        {
        "action": "highlight",
        "path": "/cs/Calculator.Specs/CalculatorTests.cs",
        "position": "22"
        }
      ]
    },
    {
      "title": "Fix \"Subtract_ReturnsRemainder\" test",
      "description": "Replace the weak assertion with a precise value check that will catch arithmetic operator mutations.",
      "steps": [
        {
          "action": "replace",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "22",
          "content": "            Assert.Equal(2, result);"
        }
      ]
    },
    {
      "title": "Show \"Multiply_ByZero_ReturnsZero\" test",
      "description": "Examine the existing multiply test that only covers the zero edge case, missing normal multiplication scenarios.",
      "steps": [
        {
        "action": "highlight",
        "path": "/cs/Calculator.Specs/CalculatorTests.cs",
        "position": "30"
        }
      ]
    },
    {
      "title": "Add \"Multiply_ReturnsProduct\" test",
      "description": "Add a new test for normal multiplication cases to catch mutants that survive the zero-only test scenario.",
      "steps": [
        {
          "action": "unselect",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs"
        },
        {
          "action": "insert",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
          "position": "32",
          "content": "\n        [Fact]\n        public void Multiply_ReturnsProduct()\n        {\n            var result = this.calculator.Multiply(1, 5);\n\n            Assert.Equal(5, result);\n        }\n",
          "lineInsertionDelay": 500
        },
        {
          "action": "highlight",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs",
        "position": "33:39"
        }
      ]
    },
    {
      "title": "Run Stryker.NET",
      "description": "Re-run mutation testing with improved tests to see how the mutation score improves when tests have better assertions.",
      "steps": [
        {
          "action": "unselect",
          "path": "/cs/Calculator.Specs/CalculatorTests.cs"
        },
        {
          "action": "executeTerminalCommand",
          "command": "dotnet stryker"
        }
      ]
    },
    {
      "title": "Show Mutation Report",
      "description": "View the updated mutation report to compare the improved mutation score after fixing weak test assertions.",
      "steps": [
        {
          "action": "executeTerminalCommand",
          "command": "& (Get-ChildItem \"StrykerOutput\" -Directory | Sort-Object LastWriteTime -Descending | Select-Object -First 1 | ForEach-Object { Join-Path $_.FullName \"reports\\mutation-report.html\" })"
        }
      ]
    }
  ]
}